SELECT user_dim.user_id AS uid, user_dim.geo_info.country, user_dim.app_info.app_version, user_dim.device_info.device_category, user_dim.device_info.mobile_brand_name, user_dim.device_info.mobile_model_name, dim.name AS tutorial_name, LOWER(user_dim.app_info.app_platform) AS platform, TIMESTAMP_MICROS(dim.timestamp_micros) AS event_timestamp, TIMESTAMP_MICROS(user_dim.first_open_timestamp_micros) AS user_creation_timestamp, DATE_DIFF(EXTRACT(date FROM TIMESTAMP_MICROS(dim.timestamp_micros)), EXTRACT(date FROM TIMESTAMP_MICROS(user_dim.first_open_timestamp_micros)), DAY) AS days_retained, user_dim.ltv_info.revenue, ( SELECT value.value.string_value FROM UNNEST(user_dim.user_properties) WHERE key = "first_app_version" ) AS first_app_version, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "session_coins" ) AS session_coins, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "total_coins" ) AS total_coins, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "total_gems" ) AS total_gems, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "session_gems" ) AS session_gems, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "session_time" ) AS session_time, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "total_time" ) AS total_time, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "total_play_time" ) AS total_play_time, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "wc_rank" ) AS wc_rank, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "coins" ) AS coins, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "gems" ) AS gems, ( SELECT value.value.string_value FROM UNNEST(user_dim.user_properties) WHERE key = "rank" ) AS user_property_rank FROM `hill-climb-racing-2-67064304.com_fingersoft_hcr2_ANDROID.app_events_20170507`, UNNEST(event_dim) AS dim WHERE dim.name LIKE '%tutorial%' AND user_dim.user_id NOT IN ( SELECT uid FROM `hill-climb-racing-2-67064304.materialized_views.lifetime_cheaters_hackers`) UNION ALL SELECT user_dim.user_id AS uid, user_dim.geo_info.country, user_dim.app_info.app_version, user_dim.device_info.device_category, user_dim.device_info.mobile_brand_name, user_dim.device_info.mobile_model_name, dim.name AS tutorial_name, LOWER(user_dim.app_info.app_platform) AS platform, TIMESTAMP_MICROS(dim.timestamp_micros) AS event_timestamp, TIMESTAMP_MICROS(user_dim.first_open_timestamp_micros) AS user_creation_timestamp, DATE_DIFF(EXTRACT(date FROM TIMESTAMP_MICROS(dim.timestamp_micros)), EXTRACT(date FROM TIMESTAMP_MICROS(user_dim.first_open_timestamp_micros)), DAY) AS days_retained, user_dim.ltv_info.revenue, ( SELECT value.value.string_value FROM UNNEST(user_dim.user_properties) WHERE key = "first_app_version" ) AS first_app_version, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "session_coins" ) AS session_coins, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "total_coins" ) AS total_coins, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "total_gems" ) AS total_gems, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "session_gems" ) AS session_gems, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "session_time" ) AS session_time, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "total_time" ) AS total_time, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "total_play_time" ) AS total_play_time, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "wc_rank" ) AS wc_rank, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "coins" ) AS coins, ( SELECT value.string_value FROM UNNEST(dim.params) WHERE key = "gems" ) AS gems, ( SELECT value.value.string_value FROM UNNEST(user_dim.user_properties) WHERE key = "rank" ) AS user_property_rank FROM `hill-climb-racing-2-67064304.com_fingersoft_hillclimbracing2_IOS.app_events_20170507`, UNNEST(event_dim) AS dim WHERE dim.name LIKE '%tutorial%' AND user_dim.user_id NOT IN ( SELECT uid FROM `hill-climb-racing-2-67064304.materialized_views.lifetime_cheaters_hackers`)
